# T1563.001 - Remote Service Session Hijacking: SSH Hijacking
## [Description from ATT&CK](https://attack.mitre.org/techniques/T1563/001)
<blockquote>Adversaries may hijack a legitimate user's SSH session to move laterally within an environment. Secure Shell (SSH) is a standard means of remote access on Linux and macOS systems. It allows a user to connect to another system via an encrypted tunnel, commonly authenticating through a password, certificate or the use of an asymmetric encryption key pair.

In order to move laterally from a compromised host, adversaries may take advantage of trust relationships established with other systems via public key authentication in active SSH sessions by hijacking an existing connection to another system. This may occur through compromising the SSH agent itself or by having access to the agent's socket. If an adversary is able to obtain root access, then hijacking SSH sessions is likely trivial.(Citation: Slideshare Abusing SSH)(Citation: SSHjack Blackhat)(Citation: Clockwork SSH Agent Hijacking)(Citation: Breach Post-mortem SSH Hijack)

[SSH Hijacking](https://attack.mitre.org/techniques/T1563/001) differs from use of [SSH](https://attack.mitre.org/techniques/T1021/004) because it hijacks an existing SSH session rather than creating a new session using [Valid Accounts](https://attack.mitre.org/techniques/T1078).</blockquote>

## Atomic Tests

- [Atomic Test #1 - SSH Session Hijacking via SSH_AUTH_SOCK](#atomic-test-1---ssh-session-hijacking-via-ssh_auth_sock)


<br/>

## Atomic Test #1 - SSH Session Hijacking via SSH_AUTH_SOCK
This test simulates an SSH session hijacking by starting a new ssh-agent and using its SSH_AUTH_SOCK for the hijacking process.

**Supported Platforms:** Linux


**auto_generated_guid:** 7819dc90-13da-4c7d-bc6d-f8de5e872ae6






#### Attack Commands: Run with `bash`! 


```bash
# Start a new ssh-agent instance and capture its SSH_AUTH_SOCK
eval $(ssh-agent -s)
OLD_SSH_AUTH_SOCK=$SSH_AUTH_SOCK
# Kill the initial ssh-agent and start a new one to simulate hijacking
eval $(ssh-agent -k)
eval $(ssh-agent -s)
NEW_SSH_AUTH_SOCK=$SSH_AUTH_SOCK
# Temporarily switch back to the old SSH agent to simulate an application using the outdated socket
export SSH_AUTH_SOCK=$OLD_SSH_AUTH_SOCK
# Simulate SSH session hijacking by switching to the new SSH_AUTH_SOCK
SSH_AUTH_SOCK=$NEW_SSH_AUTH_SOCK ssh username@target_host 2>/dev/null
```

#### Cleanup Commands:
```bash
eval $(ssh-agent -k)
```



#### Dependencies:  Run with `bash`!
##### Description: Ensure ssh is available on the system
##### Check Prereq Commands:
```bash
which ssh
```
##### Get Prereq Commands:
```bash
sudo apt-get update && sudo apt-get install -y ssh
```




<br/>
