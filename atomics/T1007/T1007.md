# T1007 - System Service Discovery
## [Description from ATT&CK](https://attack.mitre.org/techniques/T1007)
<blockquote>Adversaries may try to gather information about registered local system services. Adversaries may obtain information about services using tools as well as OS utility commands such as <code>sc query</code>, <code>tasklist /svc</code>, <code>systemctl --type=service</code>, and <code>net start</code>.

Adversaries may use the information from [System Service Discovery](https://attack.mitre.org/techniques/T1007) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.</blockquote>

## Atomic Tests

- [Atomic Test #1 - System Service Discovery](#atomic-test-1---system-service-discovery)

- [Atomic Test #2 - System Service Discovery - net.exe](#atomic-test-2---system-service-discovery---netexe)

- [Atomic Test #3 - System Service Discovery - systemctl/service](#atomic-test-3---system-service-discovery---systemctlservice)

- [Atomic Test #4 - System Service Discovery - service/status-all](#atomic-test-4---system-service-discovery---servicestatus-all)

- [Atomic Test #5 - File Read - /etc/init.d](#atomic-test-5---file-read---etcinitd)

- [Atomic Test #6 - System Service Discovery with systemctl on Linux](#atomic-test-6---system-service-discovery-with-systemctl-on-linux)


<br/>

## Atomic Test #1 - System Service Discovery
Identify system services.
Upon successful execution, cmd.exe will execute service commands with expected result to stdout.

**Supported Platforms:** Windows


**auto_generated_guid:** 89676ba1-b1f8-47ee-b940-2e1a113ebc71






#### Attack Commands: Run with `command_prompt`!  Elevation Required (e.g. root or admin) 


```cmd
tasklist.exe
sc query
sc query state= all
```






<br/>
<br/>

## Atomic Test #2 - System Service Discovery - net.exe
Enumerates started system services using net.exe and writes them to a file. This technique has been used by multiple threat actors.
Upon successful execution, net.exe will run from cmd.exe that queries services. Expected output is to a txt file in in the temp directory called service-list.txt.

**Supported Platforms:** Windows


**auto_generated_guid:** 5f864a3f-8ce9-45c0-812c-bdf7d8aeacc3





#### Inputs:
| Name | Description | Type | Default Value |
|------|-------------|------|---------------|
| output_file | Path of file to hold net.exe output | path | %temp%&#92;service-list.txt|


#### Attack Commands: Run with `command_prompt`! 


```cmd
net.exe start >>  #{output_file}
```

#### Cleanup Commands:
```cmd
del /f /q /s  #{output_file} >nul 2>&1
```





<br/>
<br/>

## Atomic Test #3 - System Service Discovery - systemctl/service
Enumerates system service using systemctl/service

**Supported Platforms:** Linux


**auto_generated_guid:** f4b26bce-4c2c-46c0-bcc5-fce062d38bef






#### Attack Commands: Run with `bash`! 


```bash
if [ "$(uname)" = 'FreeBSD' ]; then service -e; else systemctl --type=service; fi;
```






<br/>
<br/>

## Atomic Test #4 - System Service Discovery - service/status-all
Enumerates system service using service/status-all

**Supported Platforms:** Linux


**auto_generated_guid:** 7a8c3e96-c2a9-4f12-bd39-1a24332b8a10






#### Attack Commands: Run with `bash`! 


```bash
service --status-all
```






<br/>
<br/>

## Atomic Test #5 - File Read - /etc/init.d
Detects file read events on files within /etc/init.d directory

**Supported Platforms:** Linux


**auto_generated_guid:** e8d7b7b1-8870-4c0d-bcf1-2f5e8c1581f7






#### Attack Commands: Run with `bash`! 


```bash
cat /etc/init.d/*
```






<br/>
<br/>

## Atomic Test #6 - System Service Discovery with systemctl on Linux
This atomic test simulates System Service Discovery (T1007) by listing all units known to systemd on a Linux system. 
It uses the `systemctl list-units` command to enumerate all units, which can provide valuable information about system services, 
their statuses, and configurations. The output is redirected to a specified file, which should be cleaned up after the test.

**Supported Platforms:** Linux


**auto_generated_guid:** d902beb6-b845-4e13-bdcb-8f8d6be0437d





#### Inputs:
| Name | Description | Type | Default Value |
|------|-------------|------|---------------|
| output_file | The file path where the output of the `systemctl list-units` command will be saved. | String | /tmp/atomic_red_team_t1007_output.txt|


#### Attack Commands: Run with `sh`! 


```sh
systemctl list-units > #{output_file}
```

#### Cleanup Commands:
```sh
rm -f #{output_file}
```





<br/>
